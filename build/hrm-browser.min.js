/*! hrmsandbox - v0.9.0 - 2015-11-15 */!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){window.HrmProgram=require("./hrm-engine.js"),window.HrmProgramState=require("./hrmProgramState.js"),window.HrmProgramError=require("./hrmProgramError.js")},{"./hrm-engine.js":2,"./hrmProgramError.js":3,"./hrmProgramState.js":4}],2:[function(require,module,exports){"use strict";function checkValue(value){return"number"==typeof value?value>=MIN_VALUE&&MAX_VALUE>=value:!0}function findIndex(list,predicate){for(var length=list.length,i=0;length>i;i++)if(predicate(list[i],i,list))return i;return-1}function Parse(source,options){options=options||{};var program=hrm.parser.parse(source);return new HrmProgram(program,options)}var hrm=require("hrm-grammar"),HrmProgramError=require("./hrmProgramError.js"),HrmProgramState=require("./hrmProgramState.js"),MAX_STATEMENTS=255,MAX_ITERATIONS=5e3,MIN_VALUE=-999,MAX_VALUE=999,HrmProgram=function(program,options){if(!(this instanceof HrmProgram))return new HrmProgram(options);if(options=options||{},this._program=program||{statements:[]},this._program.statements.length>MAX_STATEMENTS)throw new Error("Program exceeded maximum length ("+MAX_STATEMENTS+"): "+this._program.statements.length);this.maxIterations=options.maxIterations||MAX_ITERATIONS,this.debug=options.debug,this._breakpoints=[],this._instructionCount=0,this._labels={};for(var ix=0;ix<this._program.statements.length;++ix){var stmt=this._program.statements[ix];"label"===stmt.type?this._labels[stmt.label]=ix:"define"!==stmt.type&&"comment"!==stmt.type&&this._instructionCount++}};HrmProgram.prototype.setBreakpoints=function(breakpoints){var self=this;this._breakpoints=breakpoints.map(function(bp){return findIndex(self._program.statements,function(stmt){return stmt._location.start.line===bp})}).filter(function(bp){return bp>=0}),console.dir(this._breakpoints)},HrmProgram.prototype.createState=function(options){options=options||{};var state=new HrmProgramState(options);return state},HrmProgram.prototype.step=function(state){if(state.ip>=0&&state.ip<this._program.statements.length&&state.iterations++<MAX_ITERATIONS){var statements=this._program.statements;if(!state.isAtBreakpoint&&this._breakpoints.indexOf(state.ip)>=0)return state.isAtBreakpoint=!0,state.labelsHit++,"break";state.isAtBreakpoint&&(state.isAtBreakpoint=!1);var stmt=statements[state.ip++];switch(stmt.type){case"define":state.labelsHit++;break;case"comment":state.labelsHit++;break;case"label":state.labelsHit++;break;case"inbox":state.hand=this.do_inbox(state);break;case"outbox":state.hand=this.do_outbox(state);break;case"copyfrom":state.hand=this.do_copyfrom(state,stmt.arg);break;case"copyto":state.hand=this.do_copyto(state,stmt.arg);break;case"add":case"sub":case"bumpup":case"bumpdn":if(state.hand=this.do_math(state,stmt.type,stmt.arg),!checkValue(state.hand))throw new HrmProgramError("Value out of bounds",state);break;case"jump":state.ip=this.do_jump(state,stmt.label);break;case"jumpz":state.ip=this.do_jumpz(state,stmt.label);break;case"jumpn":state.ip=this.do_jumpneg(state,stmt.label);break;default:throw new HrmProgramError("Unknown instruction: "+stmt.type,state)}return!0}return!1},HrmProgram.prototype.resume=function(state){for(;state.ip>=0&&state.ip<this._program.statements.length&&state.iterations<this.maxIterations;)if("break"===this.step(state))return"break"},HrmProgram.prototype.execute=function(options){for(var state=new HrmProgramState(options);state.ip>=0&&state.ip<this._program.statements.length&&state.iterations<this.maxIterations;)if("break"===this.step(state))return"break"},HrmProgram.prototype.do_inbox=function(state){if(state.inbox.length){var value=state.inbox.shift();if(!checkValue(value))throw new HrmProgramError("Value out of bounds",state);return value}return state.ip=-1,void state.labelsHit++},HrmProgram.prototype.do_outbox=function(state){if(void 0!==state.hand)return void state.outbox.push(state.hand);throw new HrmProgramError("Nothing in your hand to outbox!",state)},HrmProgram.prototype.do_copyfrom=function(state,variable){return state.load(variable)},HrmProgram.prototype.do_copyto=function(state,variable){if(void 0!==state.hand)return state.store(variable,state.hand);throw new HrmProgramError("Cannot copy to variable with an empty hand",state)},HrmProgram.prototype.do_jump=function(state,label){if(!this._labels.hasOwnProperty(label))throw new HrmProgramError("Unknown label: "+label,state);return this._labels[label]},HrmProgram.prototype.do_jumpz=function(state,label){if(void 0===state.hand)throw new HrmProgramError("Cannot jumpz with an empty hand",state);if(!this._labels.hasOwnProperty(label))throw new HrmProgramError("Unknown label: "+label,state);return 0===state.hand?this._labels[label]:state.ip},HrmProgram.prototype.do_jumpneg=function(state,label){if(void 0===state.hand)throw new HrmProgramError("Cannot jumpneg with an empty hand",state);if(!this._labels.hasOwnProperty(label))throw new HrmProgramError("Unknown label: "+label,state);return state.hand<0?this._labels[label]:state.ip},HrmProgram.prototype.do_math=function(state,op,variable){if("bumpup"!==op&&"bumpdn"!==op&&void 0===state.hand)throw new HrmProgramError("Cannot "+op+" with an empty hand.",state);if(!state.isDefined(variable.name))throw new HrmProgramError("Cannot "+op+" with an undefined variable: "+variable.name,state);var value=state.load(variable);switch(op){case"add":if("number"!=typeof state.hand||"number"!=typeof value)throw new HrmProgramError("Cannot add non-numeric arguments",state);return state.hand+value;case"sub":if("number"==typeof state.hand){if("number"!=typeof value)throw new HrmProgramError("Cannot subtract arguments of different types",state);return state.hand-value}if("number"==typeof value)throw new HrmProgramError("Cannot subtract arguments of different types",state);return state.hand.charCodeAt(0)-value.charCodeAt(0);case"bumpup":if("number"!=typeof value)throw new HrmProgramError("Cannot bumpup non-numeric argument",state);if(!checkValue(++value))throw new HrmProgramError("Value out of bounds",state);return state.store(variable,value);case"bumpdn":if("number"!=typeof value)throw new HrmProgramError("Cannot bumpdn non-numeric argument",state);if(!checkValue(--value))throw new HrmProgramError("Value out of bounds",state);return state.store(variable,value);default:throw new HrmProgramError("Unsupported math operation: "+op,state)}},module.exports={parse:Parse}},{"./hrmProgramError.js":3,"./hrmProgramState.js":4,"hrm-grammar":10}],3:[function(require,module,exports){"use strict";function HrmProgramError(message,internalState){this.message=message,this.internalState=internalState,this.name="HrmProgramError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,HrmProgramError),Error.call(this)}var util=require("util");util.inherits(HrmProgramError,Error),module.exports=HrmProgramError},{util:8}],4:[function(require,module,exports){"use strict";var HrmProgramError=(require("util"),require("./hrmProgramError.js")),HrmProgramState=function(options){return this instanceof HrmProgramState?(options=options||{},this.inbox=options.inbox||[],this.variables=options.variables||{},this.outbox=[],this.hand=void 0,this.ip=0,this.isAtBreakpoint=!1,this.iterations=0,void(this.labelsHit=0)):new HrmProgramState(options)};module.exports=HrmProgramState,HrmProgramState.prototype.isDefined=function(variable){return this.variables.hasOwnProperty(variable)&&void 0!==this.variables[variable]},HrmProgramState.prototype.load=function(variable){if(!this.isDefined(variable.name))throw new HrmProgramError("Undefined variable: "+variable.name,this);switch(variable.type){case"Identifier":return this.variables[variable.name];case"IndirectIdentifier":var address=this.variables[variable.name];if("number"!=typeof address||0>address)throw new HrmProgramError("Invalid address: "+address);if(this.isDefined(address))return this.variables[address];throw new HrmProgramError("Undefined variable: "+address,this);default:throw new HrmProgramError("Unsupported addressing mode: "+variable.type,this)}},HrmProgramState.prototype.store=function(variable,value){if(void 0===value)throw new HrmProgramError("Cannot store undefined value");switch(variable.type){case"Identifier":return this.variables[variable.name]=value,value;case"IndirectIdentifier":if(this.isDefined(variable.name)){var address=this.variables[variable.name];if("number"!=typeof address||0>address)throw new HrmProgramError("Invalid address: "+address);return this.variables[address]=value,value}throw new HrmProgramError("Undefined variable: "+variable.name,this);default:throw new HrmProgramError("Unsupported addressing mode: "+variable.type,this)}}},{"./hrmProgramError.js":3,util:8}],5:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],6:[function(require,module,exports){function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var timeout=setTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,clearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],7:[function(require,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],8:[function(require,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(0>recurseTimes)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;l>i;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0,length=output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);return length>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return 10>n?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];len>i;x=args[++i])str+=isNull(x)||!isObject(x)?" "+x:" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(process.noDeprecation===!0)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":7,_process:6,inherits:5}],9:[function(require,module,exports){module.exports=function(){"use strict";function peg$subclass(child,parent){function ctor(){this.constructor=child}ctor.prototype=parent.prototype,child.prototype=new ctor}function peg$SyntaxError(message,expected,found,location){this.message=message,this.expected=expected,this.found=found,this.location=location,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,peg$SyntaxError)}function peg$parse(input){function location(){return peg$computeLocation(peg$savedPos,peg$currPos)}function error(message){throw peg$buildException(message,null,input.substring(peg$savedPos,peg$currPos),peg$computeLocation(peg$savedPos,peg$currPos))}function peg$computePosDetails(pos){var p,ch,details=peg$posDetailsCache[pos];if(details)return details;for(p=pos-1;!peg$posDetailsCache[p];)p--;for(details=peg$posDetailsCache[p],details={line:details.line,column:details.column,seenCR:details.seenCR};pos>p;)ch=input.charAt(p),"\n"===ch?(details.seenCR||details.line++,details.column=1,details.seenCR=!1):"\r"===ch||"\u2028"===ch||"\u2029"===ch?(details.line++,details.column=1,details.seenCR=!0):(details.column++,details.seenCR=!1),p++;return peg$posDetailsCache[pos]=details,details}function peg$computeLocation(startPos,endPos){var startPosDetails=peg$computePosDetails(startPos),endPosDetails=peg$computePosDetails(endPos);return{start:{offset:startPos,line:startPosDetails.line,column:startPosDetails.column},end:{offset:endPos,line:endPosDetails.line,column:endPosDetails.column}}}function peg$fail(expected){peg$maxFailPos>peg$currPos||(peg$currPos>peg$maxFailPos&&(peg$maxFailPos=peg$currPos,peg$maxFailExpected=[]),peg$maxFailExpected.push(expected))}function peg$buildException(message,expected,found,location){function cleanupExpected(expected){var i=1;for(expected.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});i<expected.length;)expected[i-1]===expected[i]?expected.splice(i,1):i++}function buildMessage(expected,found){function stringEscape(s){function hex(ch){return ch.charCodeAt(0).toString(16).toUpperCase()}return s.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(ch){return"\\x0"+hex(ch)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(ch){return"\\x"+hex(ch)}).replace(/[\u0100-\u0FFF]/g,function(ch){return"\\u0"+hex(ch)}).replace(/[\u1000-\uFFFF]/g,function(ch){return"\\u"+hex(ch)})}var expectedDesc,foundDesc,i,expectedDescs=new Array(expected.length);for(i=0;i<expected.length;i++)expectedDescs[i]=expected[i].description;return expectedDesc=expected.length>1?expectedDescs.slice(0,-1).join(", ")+" or "+expectedDescs[expected.length-1]:expectedDescs[0],foundDesc=found?'"'+stringEscape(found)+'"':"end of input","Expected "+expectedDesc+" but "+foundDesc+" found."}return null!==expected&&cleanupExpected(expected),new peg$SyntaxError(null!==message?message:buildMessage(expected,found),expected,found,location)}function peg$parseStart(){var s0,s1;return s0=peg$currPos,s1=peg$parseProgram(),s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c0(s1)),s0=s1}function peg$parseProgram(){var s0,s1,s2,s3;return s0=peg$currPos,s1=peg$parse__(),s1!==peg$FAILED?(s2=peg$parseLines(),s2===peg$FAILED&&(s2=null),s2!==peg$FAILED?(s3=peg$parse__(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c1(s2),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),s0}function peg$parseLines(){var s0,s1,s2,s3,s4,s5,s6;if(s0=peg$currPos,s1=peg$parse__(),s1!==peg$FAILED)if(s2=peg$parseLine(),s2!==peg$FAILED){for(s3=[],s4=peg$currPos,s5=peg$parse__(),s5!==peg$FAILED?(s6=peg$parseLine(),s6!==peg$FAILED?(s5=[s5,s6],s4=s5):(peg$currPos=s4,s4=peg$FAILED)):(peg$currPos=s4,s4=peg$FAILED);s4!==peg$FAILED;)s3.push(s4),s4=peg$currPos,s5=peg$parse__(),s5!==peg$FAILED?(s6=peg$parseLine(),s6!==peg$FAILED?(s5=[s5,s6],s4=s5):(peg$currPos=s4,s4=peg$FAILED)):(peg$currPos=s4,s4=peg$FAILED);s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c2(s2,s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return s0}function peg$parseLine(){var s0,s1,s2,s3;return s0=peg$currPos,s1=peg$parse_(),s1!==peg$FAILED?(s2=peg$parseStatement(),s2!==peg$FAILED?(s3=peg$parse_(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c3(s2),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),s0}function peg$parseStatement(){var s0,s1,s2,s3,s4;return s0=peg$parseUnterminatedStatement(),s0===peg$FAILED&&(s0=peg$currPos,s1=peg$parseTerminatedStatement(),s1!==peg$FAILED?(s2=peg$parse_(),s2!==peg$FAILED?(s3=peg$parseComment(),s3===peg$FAILED&&(s3=null),s3!==peg$FAILED?(s4=peg$parseLineTerminatorSequence(),s4===peg$FAILED&&(s4=peg$parseEOF()),s4!==peg$FAILED?(peg$savedPos=s0,s1=peg$c4(s1),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)),s0}function peg$parseUnterminatedStatement(){var s0;return s0=peg$parseLabelStatement(),s0===peg$FAILED&&(s0=peg$parseNoArgStatement()),s0}function peg$parseTerminatedStatement(){var s0;return s0=peg$parseLabeledJumpStatement(),s0===peg$FAILED&&(s0=peg$parseOneArgStatement(),s0===peg$FAILED&&(s0=peg$parseDefineStatement(),s0===peg$FAILED&&(s0=peg$parseCommentStatement()))),s0}function peg$parseNoArgStatement(){var s0;return s0=peg$parseInboxStatement(),s0===peg$FAILED&&(s0=peg$parseOutboxStatement()),s0}function peg$parseOneArgStatement(){var s0;return s0=peg$parseAddStatement(),s0===peg$FAILED&&(s0=peg$parseSubStatement(),s0===peg$FAILED&&(s0=peg$parseBumpupStatement(),s0===peg$FAILED&&(s0=peg$parseBumpdnStatement(),s0===peg$FAILED&&(s0=peg$parseCopytoStatement(),s0===peg$FAILED&&(s0=peg$parseCopyfromStatement()))))),s0}function peg$parseLabeledJumpStatement(){var s0;return s0=peg$parseJumpzStatement(),s0===peg$FAILED&&(s0=peg$parseJumpnStatement(),s0===peg$FAILED&&(s0=peg$parseJumpStatement())),s0}function peg$parseDefineStatement(){var s0;return s0=peg$parseDefineLabelStatement(),s0===peg$FAILED&&(s0=peg$parseDefineCommentStatement()),s0}function peg$parseLabelStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$currPos,peg$silentFails++,s2=peg$parseReservedWord(),peg$silentFails--,s2===peg$FAILED?s1=void 0:(peg$currPos=s1,s1=peg$FAILED),s1!==peg$FAILED?(s2=peg$parseLabel(),s2!==peg$FAILED?(58===input.charCodeAt(peg$currPos)?(s3=peg$c6,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c7)),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c8(s2),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c5)),s0}function peg$parseArgument(){var s0;return s0=peg$parseDirectArgument(),s0===peg$FAILED&&(s0=peg$parseIndirectArgument()),s0}function peg$parseDirectArgument(){var s0,s1,s2;if(peg$silentFails++,s0=peg$currPos,s1=[],s2=peg$parseDigit(),s2!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),s2=peg$parseDigit();else s1=peg$FAILED;return s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c10(s1)),s0=s1,peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c9)),s0}function peg$parseIndirectArgument(){var s0,s1,s2,s3,s4,s5;if(peg$silentFails++,s0=peg$currPos,91===input.charCodeAt(peg$currPos)?(s1=peg$c12,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c13)),s1!==peg$FAILED)if(s2=peg$parse__(),s2!==peg$FAILED){if(s3=[],s4=peg$parseDigit(),s4!==peg$FAILED)for(;s4!==peg$FAILED;)s3.push(s4),s4=peg$parseDigit();else s3=peg$FAILED;s3!==peg$FAILED?(s4=peg$parse__(),s4!==peg$FAILED?(93===input.charCodeAt(peg$currPos)?(s5=peg$c14,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c15)),s5!==peg$FAILED?(peg$savedPos=s0,s1=peg$c16(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c11)),s0}function peg$parseLabel(){var s0,s1,s2,s3;if(peg$silentFails++,s0=peg$currPos,s1=peg$parseLetter(),s1!==peg$FAILED){for(s2=[],s3=peg$parseLetter(),s3===peg$FAILED&&(s3=peg$parseDigit());s3!==peg$FAILED;)s2.push(s3),s3=peg$parseLetter(),s3===peg$FAILED&&(s3=peg$parseDigit());s2!==peg$FAILED?(peg$savedPos=s0,s1=peg$c18(s1,s2),s0=s1):(peg$currPos=s0,s0=peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c17)),s0}function peg$parseInboxStatement(){var s0,s1;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkInbox(),s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c20()),s0=s1,peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c19)),s0}function peg$parseOutboxStatement(){var s0,s1;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkOutbox(),s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c22()),s0=s1,peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c21)),s0}function peg$parseAddStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkAdd(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c24(s1,s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23)),s0}function peg$parseSubStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkSub(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c26(s1,s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c25)),s0}function peg$parseBumpupStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkBumpup(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c28(s1,s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c27)),s0}function peg$parseBumpdnStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkBumpdn(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c30(s1,s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c29)),s0}function peg$parseCopytoStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkCopyto(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c32(s1,s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c31)),s0}function peg$parseCopyfromStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkCopyfrom(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseArgument(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c34(s1,s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c33)),s0}function peg$parseJumpStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkJump(),
s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseLabel(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c36(s1,s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c35)),s0}function peg$parseJumpzStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkJumpz(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseLabel(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c38(s1,s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c37)),s0}function peg$parseJumpnStatement(){var s0,s1,s2,s3;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkJumpn(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parseLabel(),s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c40(s1,s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c39)),s0}function peg$parseCommentStatement(){var s0,s1,s2,s3,s4;if(peg$silentFails++,s0=peg$currPos,s1=peg$parsetkComment(),s1!==peg$FAILED)if(s2=peg$parse__(),s2!==peg$FAILED){if(s3=[],s4=peg$parseDigit(),s4!==peg$FAILED)for(;s4!==peg$FAILED;)s3.push(s4),s4=peg$parseDigit();else s3=peg$FAILED;s3!==peg$FAILED?(peg$savedPos=s0,s1=peg$c42(s3),s0=s1):(peg$currPos=s0,s0=peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c41)),s0}function peg$parseDefineLabelStatement(){var s0,s1,s2,s3,s4,s5,s6,s7,s8,s9;return peg$silentFails++,s0=peg$currPos,s1=peg$parsetkDefine(),s1!==peg$FAILED?(s2=peg$parse__(),s2!==peg$FAILED?(s3=peg$parsetkLabel(),s3!==peg$FAILED?(s4=peg$parse__(),s4!==peg$FAILED?(s5=peg$parseDirectArgument(),s5!==peg$FAILED?(s6=peg$parse_(),s6!==peg$FAILED?(s7=peg$parseLineTerminatorSequence(),s7!==peg$FAILED?(s8=peg$parse__(),s8!==peg$FAILED?(s9=peg$parseBase64Data(),s9!==peg$FAILED?(peg$savedPos=s0,s1=peg$c44(s5,s9),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c43)),s0}function peg$parseDefineCommentStatement(){var s0,s1,s2,s3,s4,s5,s6,s7,s8,s9;if(peg$silentFails++,s0=peg$currPos,s1=peg$parsetkDefine(),s1!==peg$FAILED)if(s2=peg$parse__(),s2!==peg$FAILED)if(s3=peg$parsetkComment(),s3!==peg$FAILED)if(s4=peg$parse__(),s4!==peg$FAILED){if(s5=[],s6=peg$parseDigit(),s6!==peg$FAILED)for(;s6!==peg$FAILED;)s5.push(s6),s6=peg$parseDigit();else s5=peg$FAILED;s5!==peg$FAILED?(s6=peg$parse_(),s6!==peg$FAILED?(s7=peg$parseLineTerminatorSequence(),s7!==peg$FAILED?(s8=peg$parse__(),s8!==peg$FAILED?(s9=peg$parseBase64Data(),s9!==peg$FAILED?(peg$savedPos=s0,s1=peg$c46(s5,s9),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c45)),s0}function peg$parseBase64Data(){var s0,s1,s2;return peg$silentFails++,s0=peg$currPos,s1=peg$parseBase64(),s1!==peg$FAILED?(59===input.charCodeAt(peg$currPos)?(s2=peg$c48,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c49)),s2!==peg$FAILED?(peg$savedPos=s0,s1=peg$c50(s1),s0=s1):(peg$currPos=s0,s0=peg$FAILED)):(peg$currPos=s0,s0=peg$FAILED),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c47)),s0}function peg$parseReservedWord(){var s0;return s0=peg$parsetkInbox(),s0===peg$FAILED&&(s0=peg$parsetkOutbox(),s0===peg$FAILED&&(s0=peg$parsetkCopyfrom(),s0===peg$FAILED&&(s0=peg$parsetkCopyto(),s0===peg$FAILED&&(s0=peg$parsetkAdd(),s0===peg$FAILED&&(s0=peg$parsetkSub(),s0===peg$FAILED&&(s0=peg$parsetkBumpup(),s0===peg$FAILED&&(s0=peg$parsetkBumpdn(),s0===peg$FAILED&&(s0=peg$parsetkJump(),s0===peg$FAILED&&(s0=peg$parsetkJumpz(),s0===peg$FAILED&&(s0=peg$parsetkJumpn(),s0===peg$FAILED&&(s0=peg$parsetkDefine(),s0===peg$FAILED&&(s0=peg$parsetkComment(),s0===peg$FAILED&&(s0=peg$parsetkLabel()))))))))))))),s0}function peg$parsetkInbox(){var s0;return input.substr(peg$currPos,5)===peg$c51?(s0=peg$c51,peg$currPos+=5):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c52)),s0}function peg$parsetkOutbox(){var s0;return input.substr(peg$currPos,6)===peg$c53?(s0=peg$c53,peg$currPos+=6):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c54)),s0}function peg$parsetkCopyto(){var s0;return input.substr(peg$currPos,6)===peg$c55?(s0=peg$c55,peg$currPos+=6):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c56)),s0}function peg$parsetkCopyfrom(){var s0;return input.substr(peg$currPos,8)===peg$c57?(s0=peg$c57,peg$currPos+=8):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c58)),s0}function peg$parsetkAdd(){var s0;return input.substr(peg$currPos,3)===peg$c59?(s0=peg$c59,peg$currPos+=3):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c60)),s0}function peg$parsetkSub(){var s0;return input.substr(peg$currPos,3)===peg$c61?(s0=peg$c61,peg$currPos+=3):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c62)),s0}function peg$parsetkBumpup(){var s0;return input.substr(peg$currPos,6)===peg$c63?(s0=peg$c63,peg$currPos+=6):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c64)),s0}function peg$parsetkBumpdn(){var s0;return input.substr(peg$currPos,6)===peg$c65?(s0=peg$c65,peg$currPos+=6):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c66)),s0}function peg$parsetkJump(){var s0;return input.substr(peg$currPos,4)===peg$c67?(s0=peg$c67,peg$currPos+=4):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c68)),s0}function peg$parsetkJumpz(){var s0;return input.substr(peg$currPos,5)===peg$c69?(s0=peg$c69,peg$currPos+=5):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c70)),s0}function peg$parsetkJumpn(){var s0;return input.substr(peg$currPos,5)===peg$c71?(s0=peg$c71,peg$currPos+=5):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c72)),s0}function peg$parsetkDefine(){var s0;return input.substr(peg$currPos,6)===peg$c73?(s0=peg$c73,peg$currPos+=6):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c74)),s0}function peg$parsetkComment(){var s0;return input.substr(peg$currPos,7)===peg$c75?(s0=peg$c75,peg$currPos+=7):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c76)),s0}function peg$parsetkLabel(){var s0;return input.substr(peg$currPos,5)===peg$c77?(s0=peg$c77,peg$currPos+=5):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c78)),s0}function peg$parseDigit(){var s0;return peg$c79.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c80)),s0}function peg$parseLetter(){var s0;return peg$c81.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c82)),s0}function peg$parseBase64(){var s0,s1,s2;if(s0=peg$currPos,s1=[],peg$c83.test(input.charAt(peg$currPos))?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c84)),s2!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),peg$c83.test(input.charAt(peg$currPos))?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c84));else s1=peg$FAILED;return s1!==peg$FAILED&&(peg$savedPos=s0,s1=peg$c85(s1)),s0=s1}function peg$parseComment(){var s0,s1,s2,s3,s4,s5;if(peg$silentFails++,s0=peg$currPos,input.substr(peg$currPos,2)===peg$c87?(s1=peg$c87,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c88)),s1!==peg$FAILED){for(s2=[],s3=peg$currPos,s4=peg$currPos,peg$silentFails++,s5=peg$parseLineTerminator(),peg$silentFails--,s5===peg$FAILED?s4=void 0:(peg$currPos=s4,s4=peg$FAILED),s4!==peg$FAILED?(input.length>peg$currPos?(s5=input.charAt(peg$currPos),peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c89)),s5!==peg$FAILED?(s4=[s4,s5],s3=s4):(peg$currPos=s3,s3=peg$FAILED)):(peg$currPos=s3,s3=peg$FAILED);s3!==peg$FAILED;)s2.push(s3),s3=peg$currPos,s4=peg$currPos,peg$silentFails++,s5=peg$parseLineTerminator(),peg$silentFails--,s5===peg$FAILED?s4=void 0:(peg$currPos=s4,s4=peg$FAILED),s4!==peg$FAILED?(input.length>peg$currPos?(s5=input.charAt(peg$currPos),peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c89)),s5!==peg$FAILED?(s4=[s4,s5],s3=s4):(peg$currPos=s3,s3=peg$FAILED)):(peg$currPos=s3,s3=peg$FAILED);s2!==peg$FAILED?(s1=[s1,s2],s0=s1):(peg$currPos=s0,s0=peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c86)),s0}function peg$parseWs(){var s0,s1;return peg$silentFails++,32===input.charCodeAt(peg$currPos)?(s0=peg$c91,peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c92)),s0===peg$FAILED&&(9===input.charCodeAt(peg$currPos)?(s0=peg$c93,peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c94))),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c90)),s0}function peg$parseLineTerminator(){var s0;return peg$c95.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c96)),s0}function peg$parseLineTerminatorSequence(){var s0,s1;return peg$silentFails++,input.substr(peg$currPos,2)===peg$c98?(s0=peg$c98,peg$currPos+=2):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c99)),s0===peg$FAILED&&(10===input.charCodeAt(peg$currPos)?(s0=peg$c100,peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c101))),peg$silentFails--,s0===peg$FAILED&&(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c97)),s0}function peg$parseEOF(){var s0,s1;return s0=peg$currPos,peg$silentFails++,input.length>peg$currPos?(s1=input.charAt(peg$currPos),peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c89)),peg$silentFails--,s1===peg$FAILED?s0=void 0:(peg$currPos=s0,s0=peg$FAILED),s0}function peg$parse_(){var s0,s1;for(s0=[],s1=peg$parseWs();s1!==peg$FAILED;)s0.push(s1),s1=peg$parseWs();return s0}function peg$parse__(){var s0,s1;for(s0=[],s1=peg$parseWs(),s1===peg$FAILED&&(s1=peg$parseComment(),s1===peg$FAILED&&(s1=peg$parseLineTerminatorSequence()));s1!==peg$FAILED;)s0.push(s1),s1=peg$parseWs(),s1===peg$FAILED&&(s1=peg$parseComment(),s1===peg$FAILED&&(s1=peg$parseLineTerminatorSequence()));return s0}var peg$result,options=arguments.length>1?arguments[1]:{},peg$FAILED={},peg$startRuleFunctions={Start:peg$parseStart},peg$startRuleFunction=peg$parseStart,peg$c0=function(program){return program},peg$c1=function(body){var statements=pegutils.optionalList(body);return new commands.Program(statements)},peg$c2=function(head,tail){return pegutils.buildList(head,tail,1)},peg$c3=function(s){return s},peg$c4=function(s){return s},peg$c5={type:"other",description:"label statement"},peg$c6=":",peg$c7={type:"literal",value:":",description:'":"'},peg$c8=function(label){return new commands.Label(location(),label)},peg$c9={type:"other",description:"argument"},peg$c10=function(a){var tile=a.join("");return validator.isValidTile(tile)||error('Found tile "'+tile+'", which is not supported by the level'),{type:"Identifier",name:tile}},peg$c11={type:"other",description:"indirect argument"},peg$c12="[",peg$c13={type:"literal",value:"[",description:'"["'},peg$c14="]",peg$c15={type:"literal",value:"]",description:'"]"'},peg$c16=function(a){var tile=a.join("");return validator.canDereference()?validator.isValidTile(tile)||error('Found tile "'+tile+'", which is not supported by the level'):error("Found indirect addressing, mode not supported by the level"),{type:"IndirectIdentifier",name:tile}},peg$c17={type:"other",description:"label"},peg$c18=function(head,tail){var name=head+tail.join("");return/(IN|OUT)BOX|COPY(FROM|TO)|ADD|SUB|BUMP(UP|DN)|JUMP(N|Z)?|DEFINE|LABEL|COMMENT/.test(name)&&error("Expected label, but keyword "+name+" found"),name},peg$c19={type:"other",description:"INBOX"},peg$c20=function(){return new commands.Inbox(location())},peg$c21={type:"other",description:"OUTBOX"},peg$c22=function(){return new commands.Outbox(location())},peg$c23={type:"other",description:"ADD"},peg$c24=function(i,arg){return validator.isBlacklisted(i)&&error('Found "'+i+'", instruction not allowed by level'),new commands.Add(location(),arg)},peg$c25={type:"other",description:"SUB"},peg$c26=function(i,arg){return validator.isBlacklisted(i)&&error('Found "'+i+'", instruction not allowed by level'),new commands.Sub(location(),arg)},peg$c27={type:"other",description:"BUMPUP"},peg$c28=function(i,arg){return validator.isBlacklisted(i)&&error('Found "'+i+'", instruction not allowed by level'),new commands.Bumpup(location(),arg)},peg$c29={type:"other",description:"BUMPDN"},peg$c30=function(i,arg){return validator.isBlacklisted(i)&&error('Found "'+i+'", instruction not allowed by level'),new commands.Bumpdn(location(),arg)},peg$c31={type:"other",description:"COPYTO"},peg$c32=function(i,arg){return validator.isBlacklisted(i)&&error('Found "'+i+'", instruction not allowed by level'),new commands.Copyto(location(),arg)},peg$c33={type:"other",description:"COPYFROM"},peg$c34=function(i,arg){return validator.isBlacklisted(i)&&error('Found "'+i+'", instruction not allowed by level'),new commands.Copyfrom(location(),arg)},peg$c35={type:"other",description:"JUMP"},peg$c36=function(i,label){return validator.isBlacklisted(i)&&error('Found "'+i+'", instruction not allowed by level'),new commands.Jump(location(),label)},peg$c37={type:"other",description:"JUMPZ"},peg$c38=function(i,label){return validator.isBlacklisted(i)&&error('Found "'+i+'", instruction not allowed by level'),new commands.Jumpz(location(),label)},peg$c39={type:"other",description:"JUMPN"},peg$c40=function(i,label){return validator.isBlacklisted(i)&&error('Found "'+i+'", instruction not allowed by level'),new commands.Jumpn(location(),label)},peg$c41={type:"other",description:"COMMENT Reference"},peg$c42=function(ref){return validator.canComment()||error('Found "COMMENT", statement not allowed by level'),new commands.Comment(location(),ref.join(""))},peg$c43={type:"other",description:"DEFINE LABEL"},peg$c44=function(ref,data){return validator.canLabelTiles()||error('Found "DEFINE LABEL", statement not allowed by level'),new commands.Define(location(),"label",ref.name,data)},peg$c45={type:"other",description:"DEFINE COMMENT"},peg$c46=function(ref,data){return validator.canComment()||error('Found "DEFINE COMMENT", statement not allowed by level'),new commands.Define(location(),"comment",ref.join(""),data)},peg$c47={type:"other",description:"base64"},peg$c48=";",peg$c49={type:"literal",value:";",description:'";"'},peg$c50=function(b64){return b64},peg$c51="INBOX",peg$c52={type:"literal",value:"INBOX",description:'"INBOX"'},peg$c53="OUTBOX",peg$c54={type:"literal",value:"OUTBOX",description:'"OUTBOX"'},peg$c55="COPYTO",peg$c56={type:"literal",value:"COPYTO",description:'"COPYTO"'},peg$c57="COPYFROM",peg$c58={type:"literal",value:"COPYFROM",description:'"COPYFROM"'},peg$c59="ADD",peg$c60={type:"literal",value:"ADD",description:'"ADD"'},peg$c61="SUB",peg$c62={type:"literal",value:"SUB",description:'"SUB"'},peg$c63="BUMPUP",peg$c64={type:"literal",value:"BUMPUP",description:'"BUMPUP"'},peg$c65="BUMPDN",peg$c66={type:"literal",value:"BUMPDN",description:'"BUMPDN"'},peg$c67="JUMP",peg$c68={type:"literal",value:"JUMP",description:'"JUMP"'},peg$c69="JUMPZ",peg$c70={type:"literal",value:"JUMPZ",description:'"JUMPZ"'},peg$c71="JUMPN",peg$c72={type:"literal",value:"JUMPN",description:'"JUMPN"'},peg$c73="DEFINE",peg$c74={type:"literal",value:"DEFINE",description:'"DEFINE"'},peg$c75="COMMENT",peg$c76={type:"literal",value:"COMMENT",description:'"COMMENT"'},peg$c77="LABEL",peg$c78={type:"literal",value:"LABEL",description:'"LABEL"'},peg$c79=/^[0-9]/,peg$c80={type:"class",value:"[0-9]",description:"[0-9]"},peg$c81=/^[a-zA-Z]/,peg$c82={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},peg$c83=/^[A-Za-z0-9+\/=\r\n\t ]/,peg$c84={type:"class",value:"[A-Za-z0-9+\\/=\\r\\n\\t ]",description:"[A-Za-z0-9+\\/=\\r\\n\\t ]"},peg$c85=function(b64){return b64.join("").replace(/[\r\n\t ]/g,"")},peg$c86={type:"other",description:"comment"},peg$c87="--",peg$c88={type:"literal",value:"--",description:'"--"'},peg$c89={type:"any",description:"any character"},peg$c90={type:"other",description:"whitespace"},peg$c91=" ",peg$c92={type:"literal",value:" ",description:'" "'},peg$c93="	",peg$c94={type:"literal",value:"	",description:'"\\t"'},peg$c95=/^[\r\n]/,peg$c96={type:"class",value:"[\\r\\n]",description:"[\\r\\n]"},peg$c97={type:"other",description:"end of line"},peg$c98="\r\n",peg$c99={type:"literal",value:"\r\n",description:'"\\r\\n"'},peg$c100="\n",peg$c101={type:"literal",value:"\n",description:'"\\n"'},peg$currPos=0,peg$savedPos=0,peg$posDetailsCache=[{line:1,column:1,seenCR:!1}],peg$maxFailPos=0,peg$maxFailExpected=[],peg$silentFails=0;if("startRule"in options){if(!(options.startRule in peg$startRuleFunctions))throw new Error("Can't start parsing from rule \""+options.startRule+'".');peg$startRuleFunction=peg$startRuleFunctions[options.startRule]}var commands=require("../lib/hrm-commands.js"),validator=require("../lib/validator.js")(this.hrm$options),pegutils=require("../lib/pegutils.js");if(peg$result=peg$startRuleFunction(),peg$result!==peg$FAILED&&peg$currPos===input.length)return peg$result;throw peg$result!==peg$FAILED&&peg$currPos<input.length&&peg$fail({type:"end",description:"end of input"}),peg$buildException(null,peg$maxFailExpected,peg$maxFailPos<input.length?input.charAt(peg$maxFailPos):null,peg$maxFailPos<input.length?peg$computeLocation(peg$maxFailPos,peg$maxFailPos+1):peg$computeLocation(peg$maxFailPos,peg$maxFailPos))}return peg$subclass(peg$SyntaxError,Error),{SyntaxError:peg$SyntaxError,parse:peg$parse}}()},{"../lib/hrm-commands.js":11,"../lib/pegutils.js":12,"../lib/validator.js":13}],10:[function(require,module,exports){"use strict";function createWrapper(parser){return{parse:function(source,options){return strict.hrm$options=options||{},parser.parse(source)}}}var strict=require("./build/hrm.js"),commands=require("./lib/hrm-commands.js");module.exports={parser:createWrapper(strict),commands:commands}},{"./build/hrm.js":9,"./lib/hrm-commands.js":11}],11:[function(require,module,exports){"use strict";function isLabel(stmt){return stmt&&"label"==stmt.type}function isJump(stmt){return stmt&&("jump"==stmt.type||"jumpn"==stmt.type||"jumpz"==stmt.type)}function isExecutable(stmt){if(!stmt)return!1;switch(stmt.type){case"define":case"comment":return!1}return!0}function isComment(stmt){return stmt&&"comment"===stmt.type}function isImageDef(stmt){return stmt&&"define"===stmt.type}function addLineNumber(stmt,index){return stmt&&(stmt.lineNumber=index+1),stmt}var Inbox=(require("util"),function(location){return this instanceof Inbox?(this.type="inbox",void(this._location=location)):new Inbox(location)}),Outbox=function(location){return this instanceof Outbox?(this.type="outbox",void(this._location=location)):new Outbox(location)},Copyfrom=function(location,arg){return this instanceof Copyfrom?(this.type="copyfrom",this.arg=arg,void(this._location=location)):new Copyfrom(location,arg)},Copyto=function(location,arg){return this instanceof Copyto?(this.type="copyto",this.arg=arg,void(this._location=location)):new Copyto(location,arg)},Add=function(location,arg){return this instanceof Add?(this.type="add",this.arg=arg,void(this._location=location)):new Add(location,arg)},Sub=function(location,arg){return this instanceof Sub?(this.type="sub",this.arg=arg,void(this._location=location)):new Sub(location,arg)},Bumpup=function(location,arg){return this instanceof Bumpup?(this.type="bumpup",this.arg=arg,void(this._location=location)):new Bumpup(location,arg)},Bumpdn=function(location,arg){return this instanceof Bumpdn?(this.type="bumpdn",this.arg=arg,void(this._location=location)):new Bumpdn(location,arg)},Jump=function(location,label){return this instanceof Jump?(this.type="jump",this.label=label,void(this._location=location)):new Jump(location,label)},Jumpz=function(location,label){return this instanceof Jumpz?(this.type="jumpz",this.label=label,void(this._location=location)):new Jumpz(location,label)},Jumpn=function(location,label){return this instanceof Jumpn?(this.type="jumpn",this.label=label,void(this._location=location)):new Jumpn(location,label)},Comment=function(location,ref){return this instanceof Comment?(this.type="comment",this.ref=ref,void(this._location=location)):new Comment(location,ref)},Define=function(location,what,ref,data){return this instanceof Define?(this.type="define",this.what=what,this.ref=ref,this.data=data,void(this._location=location)):new Define(location,what,ref,data)},Label=function(location,label){return this instanceof Label?(this.type="label",this.label=label,void(this._location=location)):new Label(location,label)},Program=function(statements){if(!(this instanceof Program))return new Program(statements);this._ast=statements,this.statements=statements.filter(isExecutable),this.statements.filter(function(stmt){return!isLabel(stmt)}).forEach(addLineNumber),this.comments=statements.filter(isComment),this.imageDefinitions=statements.filter(isImageDef),this.labels=this.statements.filter(isLabel);var labels=this.labelMap=this.labels.reduce(function(map,stmt){return map[stmt.label]=stmt,map},{});this.undefinedLabels=statements.reduce(function(list,stmt){return isJump(stmt)&&(labels.hasOwnProperty(stmt.label)||list.push({label:stmt.label,referencedBy:stmt})),list},[])};module.exports={Inbox:Inbox,Outbox:Outbox,Copyfrom:Copyfrom,Copyto:Copyto,Add:Add,Sub:Sub,Bumpup:Bumpup,Bumpdn:Bumpdn,Jump:Jump,Jumpz:Jumpz,Jumpn:Jumpn,Comment:Comment,Define:Define,Label:Label,Program:Program}},{util:8}],12:[function(require,module,exports){"use strict";function extractList(list,index){var i,result=new Array(list.length);for(i=0;i<list.length;i++)result[i]=list[i][index];return result}module.exports={},module.exports.buildList=function(head,tail,index){return[head].concat(extractList(tail,index))},module.exports.optionalList=function(value){return null!==value?value:[]}},{}],13:[function(require,module,exports){"use strict";module.exports=function(options){var OPTIONS=options||{},LEVEL=OPTIONS.level;return{options:OPTIONS,level:LEVEL,isBlacklisted:function(command){return this.level&&this.level.commands?this.level.commands.indexOf(command)<0:!1},isValidTile:function(tile){return this.options.validateTiles&&this.level?this.level.floor&&tile>=0&&tile<this.level.floor.columns*this.level.floor.rows:!0},canDereference:function(){return void 0===this.level||this.level.dereferencing},canComment:function(){return void 0===this.level||this.level.comments},canLabelTiles:function(){return void 0===this.level||this.level.labels}}}},{}]},{},[1]);